<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mar y Hierro 1K | Dashboard V26</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* --- 1. SISTEMA DE DISEÑO --- */
        :root {
            --bg-body: #FAFAFA;
            --bg-card: #FFFFFF;
            --font-main: 'Inter', system-ui, -apple-system, sans-serif;
            
            --text-primary: #18181B;   
            --text-secondary: #71717A; 
            
            /* Colores de Fase (Preservados para el color del Día) */
            --p1-blue: #3B82F6;
            --p2-green: #10B981;
            --p3-amber: #F59E0B;
            --p4-red: #EF4444;

            --radius: 12px;
            --shadow-subtle: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            
            /* Tendencias */
            --trend-good: #10B981;
            --trend-bad: #EF4444;
            --bg-good: #ECFDF5;
            --bg-bad: #FEF2F2;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            color: var(--text-primary);
            padding: 3rem 2rem;
            display: flex;
            justify-content: center;
        }

        .wrapper { 
            width: 100%;
            max-width: 1100px;
            display: flex; 
            flex-direction: column; 
            gap: 3rem; /* Espaciado ajustado tras quitar la barra */
        }

        /* --- 2. ENCABEZADO (INTACTO) --- */
        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-end;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid rgba(0,0,0,0.05);
        }

        .header-left { margin-bottom: 4px; }
        .header-left h1 { 
            font-size: 1.5rem; font-weight: 900; letter-spacing: -0.05em; text-transform: uppercase;
            color: var(--text-primary); margin-bottom: 6px; line-height: 1;
        }
        .header-left h2 { 
            font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; 
        }

        .header-right { text-align: right; }
        
        .project-day-label { 
            font-size: 3.5rem; font-weight: 800; line-height: 0.9; letter-spacing: -2px; 
            transition: color 0.3s ease;
        }
        
        .date-time-group {
            margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary); font-weight: 500;
        }
        .mono-clock { font-family: monospace; margin-left: 8px; opacity: 0.8; }

        /* --- 3. GRÁFICOS --- */
        .chart-section { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 2rem; 
            width: 100%;
        }
        @media (max-width: 850px) { .chart-section { grid-template-columns: 1fr; } }
        
        .chart-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-subtle);
            border: 1px solid rgba(0,0,0,0.03);
            min-width: 0; 
        }

        .section-title {
            font-size: 0.8rem; font-weight: 700; color: var(--text-secondary); 
            text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem;
        }
        
        .chart-box { height: 260px; width: 100%; position: relative; }

        /* --- 4. GRID DE TARJETAS --- */
        .kpi-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 1.5rem; 
            width: 100%;
        }
        @media (max-width: 1000px) { .kpi-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 700px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } }

        .card { 
            background: var(--bg-card); 
            border-radius: var(--radius); 
            padding: 1.5rem; 
            box-shadow: var(--shadow-subtle);
            border: 1px solid rgba(0,0,0,0.03);
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 120px;
        }
        
        .card-label { 
            font-size: 0.7rem; font-weight: 700; color: var(--text-secondary); 
            text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        
        .kpi-val { font-size: 1.8rem; font-weight: 800; color: var(--text-primary); letter-spacing: -1px; }
        .kpi-unit { font-size: 0.8rem; color: var(--text-secondary); font-weight: 500; margin-left: 2px; }
        
        .delta-tag { 
            align-self: flex-start; display: inline-flex; align-items: center;
            font-size: 0.7rem; font-weight: 700; padding: 4px 10px; border-radius: 20px; margin-top: auto;
        }

        footer { 
            text-align: center; margin-top: 2rem; padding-top: 2rem;
            font-size: 0.75rem; color: var(--text-secondary); opacity: 0.6;
            border-top: 1px solid rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>

<div class="wrapper">
    
    <header>
        <div class="header-left">
            <h1>Mar y Hierro 1K</h1>
            <h2>Estrategia nutricional de recomposición</h2>
        </div>
        <div class="header-right">
            <div id="day-counter" class="project-day-label">DÍA --</div>
            <div class="date-time-group">
                <span id="date-display">--</span>
                <span id="clock-display" class="mono-clock">--:--:--</span>
            </div>
        </div>
    </header>

    <div class="chart-section">
        <div class="chart-card">
            <div class="section-title">Tendencia de peso</div>
            <div class="chart-box"><canvas id="chartWeight"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="section-title">Composición corporal</div>
            <div class="chart-box"><canvas id="chartComp"></canvas></div>
        </div>
    </div>

    <div class="kpi-grid" id="kpi-container"></div>

    <footer>Scientific Minimalism V26 | Clean Layout</footer>
</div>

<script>
    // ================= CONFIGURACIÓN =================
    const CONFIG = {
        startDate: '2025-07-01T00:00:00',
        totalDays: 1000,
        heightCm: 173,
        // Mantenemos las fases SOLO para colorear el número del día
        phases: [
            { end: 400,  color: "#3B82F6" },
            { end: 650,  color: "#10B981" },
            { end: 850,  color: "#F59E0B" },
            { end: 1000, color: "#EF4444" }
        ]
    };

    // ================= DATOS ACTUALIZADOS =================
    const BODY_DATA = [
        { d: '2025-11-25', w: 103.3, f: 36.3, m: 29.0, v: 19, ba: 72, i: 34.5, bmr: 2024 },
        { d: '2025-12-05', w: 100.6, f: 35.1, m: 29.7, v: 18, ba: 70, i: 33.6, bmr: 1990 },
        { d: '2025-12-14', w: 97.2,  f: 34.4, m: 30.0, v: 17, ba: 68, i: 32.5, bmr: 1944 }
    ];

    // ================= LÓGICA =================
    function init() {
        renderKPIs();
        renderCharts();
        updateTimeLoop();
    }

    function updateTimeLoop() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('es-ES', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
        const dateStr = now.toLocaleDateString('es-ES', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
        document.getElementById('clock-display').innerText = timeStr;
        document.getElementById('date-display').innerText = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

        const start = new Date(CONFIG.startDate);
        const diff = now - start;
        const currentDay = Math.floor(diff / (1000 * 60 * 60 * 24)) + 1;
        const dayEl = document.getElementById('day-counter');
        dayEl.innerText = currentDay > 0 ? `DÍA ${currentDay}` : `T-${Math.abs(currentDay)}`;

        // Lógica de color del día (Header)
        let activeColor = "var(--text-primary)";
        let prevEnd = 0;
        for (let phase of CONFIG.phases) {
            if (currentDay > prevEnd && currentDay <= phase.end) {
                activeColor = phase.color;
                break;
            }
            prevEnd = phase.end;
        }
        
        if (currentDay > 0 && currentDay <= CONFIG.totalDays) {
            dayEl.style.color = activeColor;
        } else {
            dayEl.style.color = "var(--text-primary)";
        }

        requestAnimationFrame(updateTimeLoop);
    }

    function renderKPIs() {
        const cur = BODY_DATA[BODY_DATA.length - 1];
        const prev = BODY_DATA[BODY_DATA.length - 2];

        const metrics = [
            { l:'Peso Total',     v: cur.w,   u:'kg',   d: (cur.w - prev.w).toFixed(1),   inv: true },
            { l:'IMC',            v: cur.i,   u:'',     d: (cur.i - prev.i).toFixed(1),   inv: true },
            { l:'Grasa Corp.',    v: cur.f,   u:'%',    d: (cur.f - prev.f).toFixed(1),   inv: true },
            { l:'Músculo Esq.',   v: cur.m,   u:'%',    d: (cur.m - prev.m).toFixed(1),   inv: false },
            { l:'Grasa Visceral', v: cur.v,   u:'Nvl',  d: (cur.v - prev.v).toFixed(0),   inv: true },
            { l:'Edad Corp.',     v: cur.ba,  u:'Años', d: (cur.ba - prev.ba).toFixed(0), inv: true },
            { l:'Metabolismo',    v: cur.bmr, u:'Kcal', d: (cur.bmr - prev.bmr).toFixed(0), inv: false }
        ];

        let html = '';
        metrics.forEach(m => {
            const valDelta = parseFloat(m.d);
            const isPos = valDelta > 0;
            const isZero = valDelta === 0;
            
            let color = '#A1A1AA';
            let bg = '#F4F4F5';
            
            if (!isZero) {
                const isGood = m.inv ? !isPos : isPos;
                color = isGood ? 'var(--trend-good)' : 'var(--trend-bad)';
                bg = isGood ? 'var(--bg-good)' : 'var(--bg-bad)';
            }

            const arrow = isZero ? '-' : (isPos ? '▲' : '▼');
            const deltaStr = isZero ? '-' : `${arrow} ${Math.abs(valDelta)}`;

            html += `
                <div class="card">
                    <div class="card-label">${m.l}</div>
                    <div>
                        <span class="kpi-val">${m.v}</span><span class="kpi-unit">${m.u}</span>
                    </div>
                    <div class="delta-tag" style="color:${color}; background:${bg}">
                        ${deltaStr}
                    </div>
                </div>`;
        });
        document.getElementById('kpi-container').innerHTML = html;
    }

    // --- FUNCIÓN TOOLTIP PERSONALIZADA ---
    function customTooltipLabel(context) {
        let label = context.dataset.label || '';
        if (label) label += ': ';
        
        const currentVal = context.parsed.y;
        label += currentVal;

        if (context.chart.canvas.id === 'chartWeight') label += ' kg';
        else label += '%';

        const dataIndex = context.dataIndex;
        const dataset = context.dataset.data;
        
        if (dataIndex > 0) {
            const prevVal = dataset[dataIndex - 1];
            const diff = currentVal - prevVal;
            const sign = diff > 0 ? '▲ +' : (diff < 0 ? '▼ ' : '');
            const diffStr = diff.toFixed(1);
            if (diff !== 0) label += ` (${sign}${diffStr})`;
        }
        return label;
    }

    function renderCharts() {
        const labels = BODY_DATA.map(d => new Date(d.d).toLocaleDateString('es-ES', {day:'numeric', month:'short'}));
        const font = { family: "'Inter', sans-serif", size: 10 };
        const gridColor = 'rgba(0,0,0,0.03)';
        
        const commonOpts = {
            responsive: true, maintainAspectRatio: false,
            plugins: { 
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#18181B',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    padding: 10,
                    cornerRadius: 8,
                    displayColors: true,
                    callbacks: { label: customTooltipLabel }
                }
            },
            scales: {
                x: { grid: { display: false }, ticks: { font: font, color: '#A1A1AA' } },
                y: { grid: { borderDash: [4,4], color: gridColor }, ticks: { font: font, color: '#A1A1AA' } }
            },
            elements: { line: { tension: 0.3 } }
        };

        // Gráfico Peso
        new Chart(document.getElementById('chartWeight'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Peso',
                    data: BODY_DATA.map(d => d.w),
                    borderColor: '#18181B', borderWidth: 2,
                    pointRadius: 4, pointBackgroundColor: '#18181B', pointHoverRadius: 6,
                    fill: { target: 'origin', above: 'rgba(24, 24, 27, 0.02)' }
                }]
            },
            options: commonOpts
        });

        // Gráfico Composición
        new Chart(document.getElementById('chartComp'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'Grasa', data: BODY_DATA.map(d => d.f), borderColor: '#EF4444', borderWidth: 2, pointRadius:4, pointBackgroundColor:'#EF4444' },
                    { label: 'Músculo', data: BODY_DATA.map(d => d.m), borderColor: '#10B981', borderWidth: 2, pointRadius:4, pointBackgroundColor:'#10B981' }
                ]
            },
            options: {
                ...commonOpts,
                plugins: { 
                    ...commonOpts.plugins,
                    legend: { display: true, position: 'top', align:'end', labels: { usePointStyle: true, boxWidth: 8, font: font } } 
                }
            }
        });
    }

    init();
</script>
</body>
</html>
